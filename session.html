<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Session</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    nav {
      width: 100%;
      max-width: 1100px;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    #sessionNameBox {
      background: #555;
      color: #fff;
      padding: 10px;
      border-radius: 10px;
      width: 100%;
      max-width: 1100px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    #values {
      background: #fff;
      width: 100%;
      max-width: 1100px;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #wordsList {
      margin-top: 1rem;
    }
    /* each user's board */
    .user-board {
      margin-bottom: 1.5rem;
    }
    .user-board h3 {
      margin-bottom: .5rem;
    }
    .slot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 1rem;
    }
    .slot-card {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: .5rem;
    }
    .slot-card button,
    .slot-card select {
      width: 100%;
    }
    @media (max-width: 600px) {
      body { padding: .5rem; }
      #sessionNameBox, #values, nav { max-width: 100%; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="/">Home Page</a>
  </nav>

  <div id="sessionNameBox">Loading session…</div>

  <div id="values">
    <button id="clearButton">Clear All</button>
    <div id="wordsList"></div>
  </div>

  <script>
    // get session id from URL
    const sessionId = decodeURIComponent(
      window.location.pathname.split('/').pop().trim()
    );

    const socket = io();
    const username =
      prompt("Enter your name:") || `User-${Math.floor(Math.random() * 1000)}`;

    // show header
    document.getElementById("sessionNameBox").textContent =
      `Session: ${sessionId} (${username})`;

    // tell server we joined
    socket.emit("join", { sessionId, username });

    // fixed 8 slots
    const SONG_SLOTS = [
      "Opener",
      "Song 2",
      "Song 3",
      "Song 4",
      "Song 5",
      "Encore",
      "Cover",
      "Bustout"
    ];

    // song list (trimmed for demo, can paste your big one)
    const SONG_LIBRARY = [
   "Stay","Funk E Zekial","Landing","French Cafe","Overtired","Totally","On the Rise","Couldn't We All",
      "F.U.","Melting Lights","Julia","Schwanthem","Zydeko","Time To Ride","Sunny Day","Moonwalk","Horizon",
      "Lightning","White Night","Live Life","Upfunk","Live It Up","Walk Outside","Burning Up My Time",
      "Condenser","Fade Fast","Pop Off","Bad For You","Whoopie","Kiwi","Interzood","Penguins","Fun in Funk",
      "Somethin' for Ya","Ocean Flows","The Liquid","Porcupine","Henrietta","Too Long","Doc","Fox and Toad",
      "Offshoot","Posideon","King Kong","Dawn a New Day","High as Five","Sail On","Avalanche","Fortress",
      "Yo Soy Fiesta","Overrun","Havana","Snake Eyes","Skipjack","Elephante","Move Like That","Lost in Line",
      "Sir Real","Water","Lowdown","Su Casa","Distant Times","Paperboy","Whirled","Beanstalk","Indiglo",
      "The Town","Alright Tonight","Day In Time","My Own Way","Fall In Place","Skinner","Beneath The Surface",
      "Let The Boogie Out","Overtime","Sorcerer","Feelin' Fine","Yesterday In Time","Calm Before the Storm",
      "Underworld","Right Track","Hell Yeah","In the Bubble","Feed The Fire","Hit the Ground Runnin'",
      "Fantasy","Twitch","Mine","Donkey Hotel","Undivided","Melting Lights - live","Whirled - live",
      "Day in Time - live","Feet On The Ground - live","Bloodshot Rose","Blue Light","Cliffs","Dome People",
      "Drunk People","Dutchmaster","E Funk","Feet on the GRound","Funkijam","Go With it","Hell Yeah",
      "In the Bubble","J-Town","Miyagi","Montreal","Philosophy","Puddles","Say Cheese","Show Me","Spaced",
      "Spacejam","Steal the Shade","The Hop","The Labrynth","The Switch","The Turn","This is that","Too Long",
      "Treat Yourself","Weightless","Where Are We Going?","Winters Splinters","Wireless","New Song"
    ].sort((a,b) => a.localeCompare(b));

    // render all users' boards
    function renderGrid(session) {
      const container = document.getElementById("wordsList");
      container.innerHTML = "";

      const users = session.users || [];

      users.forEach((userObj) => {
        const boardUser = userObj.username;
        const isMe = boardUser === username;

        // wrapper for this user's board
        const board = document.createElement("div");
        board.className = "user-board";

        const title = document.createElement("h3");
        title.textContent = boardUser;
        board.appendChild(title);

        const grid = document.createElement("div");
        grid.className = "slot-grid";

        SONG_SLOTS.forEach((slot) => {
          const card = document.createElement("div");
          card.className = "slot-card";

          const h4 = document.createElement("h4");
          h4.textContent = slot;
          card.appendChild(h4);

          const currentVal =
            session.userSongs &&
            session.userSongs[boardUser] &&
            session.userSongs[boardUser][slot];

          const p = document.createElement("p");
          p.textContent = currentVal ? currentVal : "—";
          p.style.fontWeight = "bold";
          card.appendChild(p);

          if (isMe) {
            // dropdown
            const select = document.createElement("select");
            const placeholder = document.createElement("option");
            placeholder.value = "";
            placeholder.textContent = "Choose song...";
            placeholder.disabled = true;
            placeholder.selected = true;
            select.appendChild(placeholder);

            SONG_LIBRARY.forEach((song) => {
              const opt = document.createElement("option");
              opt.value = song;
              opt.textContent = song;
              select.appendChild(opt);
            });

            card.appendChild(select);

            const setBtn = document.createElement("button");
            setBtn.textContent = "Set";
            setBtn.onclick = () => {
              const chosen = select.value;
              if (!chosen) return;
              socket.emit("set-song", {
                sessionId,
                slot,
                value: chosen,
                username
              });
            };
            card.appendChild(setBtn);

            const clearBtn = document.createElement("button");
            clearBtn.textContent = "Clear";
            clearBtn.style.background = "#d9534f";
            clearBtn.onclick = () => {
              socket.emit("clear-slot", {
                sessionId,
                slot,
                username
              });
            };
            card.appendChild(clearBtn);
          }

          grid.appendChild(card);
        });

        board.appendChild(grid);
        container.appendChild(board);
      });
    }

    // when server sends updated session
    socket.on("update-session", (session) => {
      renderGrid(session);
    });

    // clear all for everyone
    document.getElementById("clearButton").addEventListener("click", () => {
      socket.emit("clear-all", { sessionId });
    });

    // show server errors
    socket.on("error", (msg) => {
      alert(msg);
    });
  </script>
</body>
</html>
